#!/usr/bin/env node
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
require("source-map-support/register");
const cdk = require("aws-cdk-lib");
const infrastructure_stack_1 = require("../lib/infrastructure-stack");
const frontend_stack_1 = require("../lib/frontend-stack");
const backend_stack_1 = require("../lib/backend-stack");
const image_optimization_stack_1 = require("../lib/image-optimization-stack");
const app = new cdk.App();
const env = {
    account: process.env.CDK_DEFAULT_ACCOUNT,
    region: process.env.CDK_DEFAULT_REGION || 'us-east-1'
};
// Environment configuration
const environment = app.node.tryGetContext('environment') || process.env.ENVIRONMENT || 'staging';
const baseDomain = app.node.tryGetContext('baseDomain') || process.env.BASE_DOMAIN;
const hostedZoneId = app.node.tryGetContext('hostedZoneId') || process.env.HOSTED_ZONE_ID;
// Domain configuration based on environment
let domainName;
if (baseDomain) {
    domainName = environment === 'production' ? baseDomain : `${environment}.${baseDomain}`;
}
const stackPrefix = environment === 'production' ? 'PhotographyPortfolio' : `PhotographyPortfolio-${environment}`;
console.log(`üöÄ Deploying ${environment} environment`);
if (domainName) {
    console.log(`üåê Domain: ${domainName}`);
}
const infrastructure = new infrastructure_stack_1.InfrastructureStack(app, `${stackPrefix}-Infra`, {
    env,
    tags: {
        Environment: environment,
        Project: 'PhotographyPortfolio'
    }
});
const backend = new backend_stack_1.BackendStack(app, `${stackPrefix}-Backend`, {
    env,
    table: infrastructure.table,
    bucket: infrastructure.bucket,
    tags: {
        Environment: environment,
        Project: 'PhotographyPortfolio'
    }
});
const imageOptimization = new image_optimization_stack_1.ImageOptimizationStack(app, `${stackPrefix}-ImageOptimization`, {
    env,
    sourceBucket: infrastructure.bucket,
    environment,
    tags: {
        Environment: environment,
        Project: 'PhotographyPortfolio'
    }
});
const frontend = new frontend_stack_1.FrontendStack(app, `${stackPrefix}-Frontend`, {
    env,
    api: backend.api,
    userPool: infrastructure.userPool,
    domainName,
    hostedZoneId,
    environment,
    tags: {
        Environment: environment,
        Project: 'PhotographyPortfolio'
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBwLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiYXBwLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUNBLHVDQUFxQztBQUNyQyxtQ0FBbUM7QUFDbkMsc0VBQWtFO0FBQ2xFLDBEQUFzRDtBQUN0RCx3REFBb0Q7QUFDcEQsOEVBQXlFO0FBRXpFLE1BQU0sR0FBRyxHQUFHLElBQUksR0FBRyxDQUFDLEdBQUcsRUFBRSxDQUFDO0FBRTFCLE1BQU0sR0FBRyxHQUFHO0lBQ1YsT0FBTyxFQUFFLE9BQU8sQ0FBQyxHQUFHLENBQUMsbUJBQW1CO0lBQ3hDLE1BQU0sRUFBRSxPQUFPLENBQUMsR0FBRyxDQUFDLGtCQUFrQixJQUFJLFdBQVc7Q0FDdEQsQ0FBQztBQUVGLDRCQUE0QjtBQUM1QixNQUFNLFdBQVcsR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxhQUFhLENBQUMsSUFBSSxPQUFPLENBQUMsR0FBRyxDQUFDLFdBQVcsSUFBSSxTQUFTLENBQUM7QUFDbEcsTUFBTSxVQUFVLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsWUFBWSxDQUFDLElBQUksT0FBTyxDQUFDLEdBQUcsQ0FBQyxXQUFXLENBQUM7QUFDbkYsTUFBTSxZQUFZLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsY0FBYyxDQUFDLElBQUksT0FBTyxDQUFDLEdBQUcsQ0FBQyxjQUFjLENBQUM7QUFFMUYsNENBQTRDO0FBQzVDLElBQUksVUFBOEIsQ0FBQztBQUNuQyxJQUFJLFVBQVUsRUFBRSxDQUFDO0lBQ2YsVUFBVSxHQUFHLFdBQVcsS0FBSyxZQUFZLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsR0FBRyxXQUFXLElBQUksVUFBVSxFQUFFLENBQUM7QUFDMUYsQ0FBQztBQUVELE1BQU0sV0FBVyxHQUFHLFdBQVcsS0FBSyxZQUFZLENBQUMsQ0FBQyxDQUFDLHNCQUFzQixDQUFDLENBQUMsQ0FBQyx3QkFBd0IsV0FBVyxFQUFFLENBQUM7QUFFbEgsT0FBTyxDQUFDLEdBQUcsQ0FBQyxnQkFBZ0IsV0FBVyxjQUFjLENBQUMsQ0FBQztBQUN2RCxJQUFJLFVBQVUsRUFBRSxDQUFDO0lBQ2YsT0FBTyxDQUFDLEdBQUcsQ0FBQyxjQUFjLFVBQVUsRUFBRSxDQUFDLENBQUM7QUFDMUMsQ0FBQztBQUVELE1BQU0sY0FBYyxHQUFHLElBQUksMENBQW1CLENBQUMsR0FBRyxFQUFFLEdBQUcsV0FBVyxRQUFRLEVBQUU7SUFDMUUsR0FBRztJQUNILElBQUksRUFBRTtRQUNKLFdBQVcsRUFBRSxXQUFXO1FBQ3hCLE9BQU8sRUFBRSxzQkFBc0I7S0FDaEM7Q0FDRixDQUFDLENBQUM7QUFFSCxNQUFNLE9BQU8sR0FBRyxJQUFJLDRCQUFZLENBQUMsR0FBRyxFQUFFLEdBQUcsV0FBVyxVQUFVLEVBQUU7SUFDOUQsR0FBRztJQUNILEtBQUssRUFBRSxjQUFjLENBQUMsS0FBSztJQUMzQixNQUFNLEVBQUUsY0FBYyxDQUFDLE1BQU07SUFDN0IsSUFBSSxFQUFFO1FBQ0osV0FBVyxFQUFFLFdBQVc7UUFDeEIsT0FBTyxFQUFFLHNCQUFzQjtLQUNoQztDQUNGLENBQUMsQ0FBQztBQUVILE1BQU0saUJBQWlCLEdBQUcsSUFBSSxpREFBc0IsQ0FBQyxHQUFHLEVBQUUsR0FBRyxXQUFXLG9CQUFvQixFQUFFO0lBQzVGLEdBQUc7SUFDSCxZQUFZLEVBQUUsY0FBYyxDQUFDLE1BQU07SUFDbkMsV0FBVztJQUNYLElBQUksRUFBRTtRQUNKLFdBQVcsRUFBRSxXQUFXO1FBQ3hCLE9BQU8sRUFBRSxzQkFBc0I7S0FDaEM7Q0FDRixDQUFDLENBQUM7QUFFSCxNQUFNLFFBQVEsR0FBRyxJQUFJLDhCQUFhLENBQUMsR0FBRyxFQUFFLEdBQUcsV0FBVyxXQUFXLEVBQUU7SUFDakUsR0FBRztJQUNILEdBQUcsRUFBRSxPQUFPLENBQUMsR0FBRztJQUNoQixRQUFRLEVBQUUsY0FBYyxDQUFDLFFBQVE7SUFDakMsVUFBVTtJQUNWLFlBQVk7SUFDWixXQUFXO0lBQ1gsSUFBSSxFQUFFO1FBQ0osV0FBVyxFQUFFLFdBQVc7UUFDeEIsT0FBTyxFQUFFLHNCQUFzQjtLQUNoQztDQUNGLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIiMhL3Vzci9iaW4vZW52IG5vZGVcbmltcG9ydCAnc291cmNlLW1hcC1zdXBwb3J0L3JlZ2lzdGVyJztcbmltcG9ydCAqIGFzIGNkayBmcm9tICdhd3MtY2RrLWxpYic7XG5pbXBvcnQgeyBJbmZyYXN0cnVjdHVyZVN0YWNrIH0gZnJvbSAnLi4vbGliL2luZnJhc3RydWN0dXJlLXN0YWNrJztcbmltcG9ydCB7IEZyb250ZW5kU3RhY2sgfSBmcm9tICcuLi9saWIvZnJvbnRlbmQtc3RhY2snO1xuaW1wb3J0IHsgQmFja2VuZFN0YWNrIH0gZnJvbSAnLi4vbGliL2JhY2tlbmQtc3RhY2snO1xuaW1wb3J0IHsgSW1hZ2VPcHRpbWl6YXRpb25TdGFjayB9IGZyb20gJy4uL2xpYi9pbWFnZS1vcHRpbWl6YXRpb24tc3RhY2snO1xuXG5jb25zdCBhcHAgPSBuZXcgY2RrLkFwcCgpO1xuXG5jb25zdCBlbnYgPSB7XG4gIGFjY291bnQ6IHByb2Nlc3MuZW52LkNES19ERUZBVUxUX0FDQ09VTlQsXG4gIHJlZ2lvbjogcHJvY2Vzcy5lbnYuQ0RLX0RFRkFVTFRfUkVHSU9OIHx8ICd1cy1lYXN0LTEnXG59O1xuXG4vLyBFbnZpcm9ubWVudCBjb25maWd1cmF0aW9uXG5jb25zdCBlbnZpcm9ubWVudCA9IGFwcC5ub2RlLnRyeUdldENvbnRleHQoJ2Vudmlyb25tZW50JykgfHwgcHJvY2Vzcy5lbnYuRU5WSVJPTk1FTlQgfHwgJ3N0YWdpbmcnO1xuY29uc3QgYmFzZURvbWFpbiA9IGFwcC5ub2RlLnRyeUdldENvbnRleHQoJ2Jhc2VEb21haW4nKSB8fCBwcm9jZXNzLmVudi5CQVNFX0RPTUFJTjtcbmNvbnN0IGhvc3RlZFpvbmVJZCA9IGFwcC5ub2RlLnRyeUdldENvbnRleHQoJ2hvc3RlZFpvbmVJZCcpIHx8IHByb2Nlc3MuZW52LkhPU1RFRF9aT05FX0lEO1xuXG4vLyBEb21haW4gY29uZmlndXJhdGlvbiBiYXNlZCBvbiBlbnZpcm9ubWVudFxubGV0IGRvbWFpbk5hbWU6IHN0cmluZyB8IHVuZGVmaW5lZDtcbmlmIChiYXNlRG9tYWluKSB7XG4gIGRvbWFpbk5hbWUgPSBlbnZpcm9ubWVudCA9PT0gJ3Byb2R1Y3Rpb24nID8gYmFzZURvbWFpbiA6IGAke2Vudmlyb25tZW50fS4ke2Jhc2VEb21haW59YDtcbn1cblxuY29uc3Qgc3RhY2tQcmVmaXggPSBlbnZpcm9ubWVudCA9PT0gJ3Byb2R1Y3Rpb24nID8gJ1Bob3RvZ3JhcGh5UG9ydGZvbGlvJyA6IGBQaG90b2dyYXBoeVBvcnRmb2xpby0ke2Vudmlyb25tZW50fWA7XG5cbmNvbnNvbGUubG9nKGDwn5qAIERlcGxveWluZyAke2Vudmlyb25tZW50fSBlbnZpcm9ubWVudGApO1xuaWYgKGRvbWFpbk5hbWUpIHtcbiAgY29uc29sZS5sb2coYPCfjJAgRG9tYWluOiAke2RvbWFpbk5hbWV9YCk7XG59XG5cbmNvbnN0IGluZnJhc3RydWN0dXJlID0gbmV3IEluZnJhc3RydWN0dXJlU3RhY2soYXBwLCBgJHtzdGFja1ByZWZpeH0tSW5mcmFgLCB7IFxuICBlbnYsXG4gIHRhZ3M6IHtcbiAgICBFbnZpcm9ubWVudDogZW52aXJvbm1lbnQsXG4gICAgUHJvamVjdDogJ1Bob3RvZ3JhcGh5UG9ydGZvbGlvJ1xuICB9XG59KTtcblxuY29uc3QgYmFja2VuZCA9IG5ldyBCYWNrZW5kU3RhY2soYXBwLCBgJHtzdGFja1ByZWZpeH0tQmFja2VuZGAsIHsgXG4gIGVudixcbiAgdGFibGU6IGluZnJhc3RydWN0dXJlLnRhYmxlLFxuICBidWNrZXQ6IGluZnJhc3RydWN0dXJlLmJ1Y2tldCxcbiAgdGFnczoge1xuICAgIEVudmlyb25tZW50OiBlbnZpcm9ubWVudCxcbiAgICBQcm9qZWN0OiAnUGhvdG9ncmFwaHlQb3J0Zm9saW8nXG4gIH1cbn0pO1xuXG5jb25zdCBpbWFnZU9wdGltaXphdGlvbiA9IG5ldyBJbWFnZU9wdGltaXphdGlvblN0YWNrKGFwcCwgYCR7c3RhY2tQcmVmaXh9LUltYWdlT3B0aW1pemF0aW9uYCwge1xuICBlbnYsXG4gIHNvdXJjZUJ1Y2tldDogaW5mcmFzdHJ1Y3R1cmUuYnVja2V0LFxuICBlbnZpcm9ubWVudCxcbiAgdGFnczoge1xuICAgIEVudmlyb25tZW50OiBlbnZpcm9ubWVudCxcbiAgICBQcm9qZWN0OiAnUGhvdG9ncmFwaHlQb3J0Zm9saW8nXG4gIH1cbn0pO1xuXG5jb25zdCBmcm9udGVuZCA9IG5ldyBGcm9udGVuZFN0YWNrKGFwcCwgYCR7c3RhY2tQcmVmaXh9LUZyb250ZW5kYCwgeyBcbiAgZW52LFxuICBhcGk6IGJhY2tlbmQuYXBpLFxuICB1c2VyUG9vbDogaW5mcmFzdHJ1Y3R1cmUudXNlclBvb2wsXG4gIGRvbWFpbk5hbWUsXG4gIGhvc3RlZFpvbmVJZCxcbiAgZW52aXJvbm1lbnQsXG4gIHRhZ3M6IHtcbiAgICBFbnZpcm9ubWVudDogZW52aXJvbm1lbnQsXG4gICAgUHJvamVjdDogJ1Bob3RvZ3JhcGh5UG9ydGZvbGlvJ1xuICB9XG59KTtcbiJdfQ==